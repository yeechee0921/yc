<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BM Peribahasa Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f2f2f2;
            max-width: 800px;
            margin: 0 auto;
        }
        .question {
            background: #fff;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .result {
            background: #e6ffe6;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .history {
            background: #e6f3ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .hidden {
            display: none;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #ddd;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: #4CAF50;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .correct {
            color: green;
        }
        .incorrect {
            color: red;
        }
        .save-buttons {
            margin-top: 20px;
            text-align: center;
        }
        .save-btn {
            background-color: #2196F3;
            margin: 5px;
        }
        .save-btn:hover {
            background-color: #0b7dda;
        }
        .whatsapp-btn {
            background-color: #25D366;
            margin: 5px;
        }
        .whatsapp-btn:hover {
            background-color: #1da851;
        }
        .download-btn {
            background-color: #FF6B35;
            margin: 5px;
        }
        .download-btn:hover {
            background-color: #E55A2B;
        }
        #reportCanvas {
            text-align: center;
        }
        .canvas-container {
            display: inline-block;
            margin: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: white;
        }
        label {
            display: block;
            margin: 5px 0;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
        }
        label:hover {
            background-color: #f0f0f0;
        }
        input[type="radio"] {
            margin-right: 8px;
        }
    </style>
</head>
<body>

<h2>BM Peribahasa Quiz - é©¬æ¥è¯­è°šè¯­æµ‹éªŒ</h2>
<div style="background: #e6f3ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
    <p><strong>ğŸ’¡ æ¸©é¦¨æç¤ºï¼š</strong></p>
    <p>â€¢ ğŸ“± <strong>å‘é€æ–‡å­—æˆç»©</strong> - ç›´æ¥å‘é€æ–‡å­—æ ¼å¼æˆç»©åˆ°è€å¸ˆWhatsApp (+60127317286)</p>
    <p>â€¢ ğŸ–¼ï¸ <strong>ä¸€é”®å‘é€å›¾ç‰‡æˆç»©å•</strong> - æ™ºèƒ½åˆ†äº«ï¼šåœ¨æ‰‹æœºä¸Šå¯ç›´æ¥é€‰æ‹©WhatsAppå‘é€å›¾ç‰‡ï¼</p>
    <p>â€¢ ğŸ“± åœ¨æ‰‹æœºä¸Šä½¿ç”¨æ—¶ï¼Œç‚¹å‡»å›¾ç‰‡æŒ‰é’®ä¼šç›´æ¥æ‰“å¼€åˆ†äº«èœå•ï¼Œé€‰æ‹©WhatsAppå³å¯ï¼</p>
    <p>â€¢ ğŸ’» åœ¨ç”µè„‘ä¸Šä½¿ç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½å›¾ç‰‡å¹¶æ‰“å¼€è€å¸ˆçš„WhatsAppå¯¹è¯</p>
    <p>â€¢ ğŸ¯ ä¸¤ç§æ–¹å¼éƒ½ç›´æ¥è¿æ¥åˆ°è€å¸ˆ (+60127317286)ï¼Œæ— éœ€æŸ¥æ‰¾è”ç³»äººï¼</p>
</div>

<div class="tabs">
    <div class="tab active" onclick="showTab('quiz')">åšæµ‹éªŒ</div>
    <div class="tab" onclick="showTab('history')">æŸ¥çœ‹è®°å½•</div>
</div>

<div id="quiz" class="tab-content active">
    <form id="quizForm">
        <label>Name (åå­—):</label><br>
        <input type="text" id="name" required><br><br>

        <label>Form (å¹´çº§):</label><br>
        <select id="form" required>
            <option value="">Select</option>
            <option value="F1">F1</option>
            <option value="F2">F2</option>
            <option value="F3">F3</option>
            <option value="F4">F4</option>
            <option value="F5">F5</option>
        </select><br><br>

        <div id="questions"></div>

        <button type="button" onclick="submitQuiz()">æäº¤ç­”æ¡ˆ</button>
        <button type="button" onclick="saveProgress()">ä¿å­˜è¿›åº¦</button>
        <button type="button" onclick="loadProgress()">åŠ è½½è¿›åº¦</button>
    </form>

    <div id="result" class="result hidden"></div>
</div>

<div id="history" class="tab-content">
    <h3>ä½ çš„æµ‹éªŒè®°å½•</h3>
    <div id="historyList"></div>
</div>

<script>
const questions = [
    {
        q: "Tabiat kaki judi ketua keluarga itu membuatkan semua anak dan isteri hidup menderita umpama __________.",
        options: ["usang dibarui, lapuk dikajangi", "rosak bawang ditimpa jambak", "cubit paha kanan, paha kiri terasa juga", "tak lapuk dek hujan, tak lekang dek panas"],
        answer: "cubit paha kanan, paha kiri terasa juga",
        explain: "å½“ä¸€ä¸ªäººå—è‹¦æ—¶ï¼Œå…¶å®¶äººä¹Ÿä¼šæ„ŸåŒèº«å—ã€‚è¿™å¥è°šè¯­è¡¨ç¤ºä¸€äººçš„è¡Œä¸ºä¼šå½±å“åˆ°æ•´ä¸ªå®¶åº­ã€‚",
        encourage: "å¯¹è°šè¯­å«ä¹‰çš„ç†è§£å¾ˆå‡†ç¡®ï¼ä½ å·²ç»æŒæ¡äº†è¿™ä¸ªè¡¨è¾¾å®¶åº­å…³ç³»çš„è°šè¯­ã€‚"
    },
    {
        q: "Siti berasa sedih melihat adiknya yang menderita penyakit leukimia kerana __________.",
        options: ["cubit paha kanan, paha kiri pun terasa juga", "rosak bawang ditimpa jambak", "usang dibarui, lapuk dikajangi", "tak lapuk dek hujan, tak lekang dek panas"],
        answer: "cubit paha kanan, paha kiri pun terasa juga",
        explain: "è¿™å¥è°šè¯­è¡¨è¾¾æ‰‹è¶³ä¹‹æƒ…ï¼Œå…„å¼Ÿå§å¦¹ä¹‹é—´çš„æ„Ÿæƒ…æ·±åšï¼Œä¸€äººç—›è‹¦ï¼Œå¦ä¸€äººä¹Ÿä¼šæ„Ÿåˆ°ç—›è‹¦ã€‚",
        encourage: "å¾ˆå¥½åœ°ç†è§£äº†äº²æƒ…ç›¸å…³çš„è°šè¯­ï¼ä½ å¯¹æƒ…æ„Ÿè¡¨è¾¾çš„è°šè¯­æŒæ¡å¾—å¾ˆæ£’ã€‚"
    },
    {
        q: "Pilihkan peribahasa yang tepat berdasarkan maksud 'sesuatu adat atau budaya yang tiada berubah-ubah dan dikekalkan selama-lamanya'",
        options: ["tiada rotan, akar pun berguna", "tak lapuk dek hujan, tak lekang dek panas", "usang dibarui, lapuk dikajangi", "orang memberi kita merasa, orang berbudi kita berbahasa"],
        answer: "tak lapuk dek hujan, tak lekang dek panas",
        explain: "è¿™å¥è°šè¯­çš„æ„æ€æ˜¯æŸäº›ä¼ ç»Ÿæˆ–æ–‡åŒ–æ°¸ä¸æ”¹å˜ï¼Œèƒ½å¤Ÿä¼ æ‰¿ä¸‹å»ï¼Œä¸å—æ—¶é—´å½±å“ã€‚",
        encourage: "å¯¹ä¼ ç»Ÿæ–‡åŒ–è°šè¯­çš„ç†è§£éå¸¸æ­£ç¡®ï¼è¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„é©¬æ¥æ–‡åŒ–æ¦‚å¿µã€‚"
    },
    {
        q: "Pilihkan peribahasa yang tepat berdasarkan maksud 'kalau tiada yang baik, maka yang kurang baik pun boleh juga'",
        options: ["tiada rotan, akar pun berguna", "tak lapuk dek hujan, tak lekang dek panas", "usang dibarui, lapuk dikajangi", "orang memberi kita merasa, orang berbudi kita berbahasa"],
        answer: "tiada rotan, akar pun berguna",
        explain: "è¿™å¥è°šè¯­è¡¨ç¤ºåœ¨æ²¡æœ‰æ›´å¥½é€‰æ‹©çš„æƒ…å†µä¸‹ï¼Œæ¬¡å¥½çš„é€‰æ‹©ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚",
        encourage: "ç†è§£äº†çµæ´»å˜é€šçš„æ™ºæ…§ï¼è¿™å¥è°šè¯­æ•™å¯¼æˆ‘ä»¬è¦æ‡‚å¾—é€‚åº”å’Œè°ƒæ•´ã€‚"
    },
    {
        q: "Pilihkan peribahasa yang tepat berdasarkan maksud 'perasaan besar hati dan bersyukur apabila mendapat sesuatu'",
        options: ["ada ubi ada batas, ada hari boleh balas", "kecil tapak tangan, nyiru ditadahkan", "usang dibarui, lapuk dikajangi", "orang memberi kita merasa, orang berbudi kita berbahasa"],
        answer: "kecil tapak tangan, nyiru ditadahkan",
        explain: "è¿™å¥è°šè¯­è¡¨è¾¾äº†å¯¹å¾—åˆ°çš„å¸®åŠ©æˆ–æ©æƒ æ„Ÿåˆ°éå¸¸æ„Ÿæ¿€ï¼Œå³ä½¿æ˜¯å°å°çš„å¸®åŠ©ä¹Ÿè¦å¿ƒå­˜æ„Ÿæ¿€ã€‚",
        encourage: "å¯¹æ„Ÿæ©è°šè¯­çš„ç†è§£å¾ˆåˆ°ä½ï¼æ‡‚å¾—æ„Ÿæ©æ˜¯å¾ˆé‡è¦çš„å“å¾·ã€‚"
    },
    {
        q: "Remaja yang menyertai konvoi berbasikal mestilah berhati-hati semasa menunggang basikal untuk mengelakkan diri daripada kemalangan jalan raya kerana _____________.",
        options: ["melentur buluh biarlah dari rebungnya", "malang tidak berbau", "mencegah lebih baik daripada mengubati", "masa itu emas"],
        answer: "mencegah lebih baik daripada mengubati",
        explain: "è¿™å¥è°šè¯­å¼ºè°ƒé¢„é˜²èƒœäºæ²»ç–—ï¼Œåœ¨é—®é¢˜å‘ç”Ÿä¹‹å‰å°±é‡‡å–é¢„é˜²æªæ–½æ˜¯æ˜æ™ºçš„åšæ³•ã€‚",
        encourage: "å®‰å…¨æ„è¯†çš„è°šè¯­ç”¨å¾—å¾ˆå‡†ç¡®ï¼é¢„é˜²çš„æ™ºæ…§ä½ å·²ç»æŒæ¡äº†ã€‚"
    },
    {
        q: "Encik Lim menjadi _________ untuk menyampaikan ucapan apabila pengerusi majlis tidak hadir. Pilih peribahasa yang sesuai:",
        options: ["bidan terjun", "bidan tarik", "mati katak", "anjing hitam"],
        answer: "bidan terjun",
        explain: "'Bidan terjun' æŒ‡çš„æ˜¯ä¸´æ—¶è¢«å®‰æ’æˆ–è¢«è¿«æ‰¿æ‹…æŸé¡¹ä»»åŠ¡çš„äººã€‚",
        encourage: "å¯¹å·¥ä½œæƒ…å¢ƒè°šè¯­çš„ç†è§£å¾ˆç²¾ç¡®ï¼ä¸´æ—¶æ‰¿æ‹…è´£ä»»çš„æ¦‚å¿µæŒæ¡å¾—å¾ˆå¥½ã€‚"
    },
    {
        q: "Pilih ayat yang sesuai untuk diisi peribahasa 'seperti katak di bawah tempurung': I. Ally dikatakan _____________ kerana tidak mengetahui peristiwa bencana alam. II. Dia menjadi _____________ apabila berbual dengan rakannya.",
        options: ["I sahaja", "II sahaja", "I dan II", "Tiada yang betul"],
        answer: "I dan II",
        explain: "'Seperti katak di bawah tempurung' å½¢å®¹è§è¯†æµ…è–„ï¼Œä¸äº†è§£å¤–é¢ä¸–ç•Œçš„äººã€‚ä¸¤ä¸ªä¾‹å­éƒ½é€‚ç”¨ã€‚",
        encourage: "å¯¹æ¯”å–»è°šè¯­çš„åº”ç”¨éå¸¸å‡†ç¡®ï¼ä½ èƒ½æ­£ç¡®è¯†åˆ«é€‚ç”¨çš„æƒ…å¢ƒã€‚"
    },
    {
        q: "Peribahasa 'tak lapuk dek hujan, tak lekang dek panas' menunjukkan sesuatu yang kekal. Pilih contoh ayat yang sesuai: I. Tarian zapin perlu dipertahankan. II. Upacara bersanding masih popular.",
        options: ["I sahaja", "II sahaja", "I dan II", "Tiada yang betul"],
        answer: "I dan II",
        explain: "ä¸¤ä¸ªä¾‹å­éƒ½è¯´æ˜äº†ä¼ ç»Ÿæ–‡åŒ–çš„æŒç»­æ€§å’Œä¸å˜æ€§ï¼Œç¬¦åˆè¿™å¥è°šè¯­çš„å«ä¹‰ã€‚",
        encourage: "å¯¹æ–‡åŒ–ä¼ æ‰¿è°šè¯­çš„åº”ç”¨ç†è§£å¾—å¾ˆå…¨é¢ï¼ä¼ ç»Ÿæ–‡åŒ–çš„é‡è¦æ€§ä½ å·²ç»æ˜ç™½äº†ã€‚"
    },
    {
        q: "Peribahasa 'kecil tapak tangan, nyiru ditadahkan' menunjukkan perasaan bersyukur. Pilih peribahasa yang BERTENTANGAN maksud:",
        options: ["bagai ulat lupakan daun", "ada hujan ada panas, ada hari boleh balas", "bagai kacang lupakan kulitnya", "A dan C"],
        answer: "A dan C",
        explain: "ä¸¤å¥è°šè¯­éƒ½è¡¨ç¤ºå¿˜æ©è´Ÿä¹‰ï¼Œä¸æ„Ÿæ©çš„å«ä¹‰ç›¸åã€‚",
        encourage: "å¯¹æ¯”åˆ†æè°šè¯­å«ä¹‰çš„èƒ½åŠ›å¾ˆå¼ºï¼ä½ èƒ½å‡†ç¡®è¯†åˆ«ç›¸åçš„æ¦‚å¿µã€‚"
    },
    {
        q: "Kemalangan jalan raya yang menimpa suaminya dan diikuti pula kematian anak tunggalnya menyebabkan Mak Cik Aina berada dalam kedukaan. Situasi ini bersesuaian dengan peribahasa:",
        options: ["sesal dahulu pendapatan, sesal kemudian tidak berguna", "cubit paha kanan, paha kiri terasa juga", "malang tidak berbau", "sudah jatuh, ditimpa tangga"],
        answer: "sudah jatuh, ditimpa tangga",
        explain: "è¿™å¥è°šè¯­å½¢å®¹ç¥¸ä¸å•è¡Œï¼Œä¸€ä¸ªä¸å¹¸æ¥ç€å¦ä¸€ä¸ªä¸å¹¸ã€‚",
        encourage: "å¯¹æè¿°è¿ç»­ä¸å¹¸çš„è°šè¯­ç†è§£å¾—å¾ˆå‡†ç¡®ï¼ä½ èƒ½æ­£ç¡®è¯†åˆ«æƒ…å¢ƒã€‚"
    },
    {
        q: "Aiman tidak berpuas hati dengan arahan majikannya yang menyuruhnya membuat pembentangan projek secara tiba-tiba. Situasi ini bersesuaian dengan peribahasa:",
        options: ["malang tidak berbau", "masa itu emas", "mencegah lebih baik daripada mengubati", "seperti katak di bawah tempurung"],
        answer: "malang tidak berbau",
        explain: "è¿™å¥è°šè¯­è¡¨ç¤ºä¸å¹¸æˆ–éº»çƒ¦æ¥å¾—çªç„¶ï¼Œæ— æ³•é¢„æ–™ã€‚",
        encourage: "å¯¹çªå‘çŠ¶å†µè°šè¯­çš„åº”ç”¨å¾ˆæ°å½“ï¼æ„å¤–æƒ…å†µçš„æè¿°ä½ æŒæ¡å¾—å¾ˆå¥½ã€‚"
    },
    {
        q: "Setiap kaum perlulah menjaga budaya tradisi yang lama agar budaya ini dapat berkekalan selama-lamanya. Peribahasa yang sesuai:",
        options: ["tiada rotan, akar pun berguna", "tak lapuk dek hujan, tak lekang dek panas", "usang dibarui, lapuk dikajangi", "seperti katak di bawah tempurung"],
        answer: "tak lapuk dek hujan, tak lekang dek panas",
        explain: "è¿™å¥è°šè¯­å¼ºè°ƒä¼ ç»Ÿæ–‡åŒ–çš„æŒä¹…æ€§å’Œä¸å˜æ€§ï¼Œé€‚åˆæè¿°æ–‡åŒ–ä¼ æ‰¿ã€‚",
        encourage: "å¯¹æ–‡åŒ–ä¿æŠ¤è°šè¯­çš„é€‰æ‹©å¾ˆç²¾å‡†ï¼æ–‡åŒ–ä¼ æ‰¿çš„é‡è¦æ€§ç†è§£å¾—å¾ˆå¥½ã€‚"
    },
    {
        q: "Ali telah membaca novel itu sedangkan majalah kegemarannya telah hilang untuk mengisi masa lapangnya. Peribahasa yang sesuai:",
        options: ["tiada rotan, akar pun berguna", "tak lapuk dek hujan, tak lekang dek panas", "malang tidak berbau", "seperti katak di bawah tempurung"],
        answer: "tiada rotan, akar pun berguna",
        explain: "è¿™å¥è°šè¯­è¡¨ç¤ºåœ¨æ²¡æœ‰æ›´å¥½é€‰æ‹©æ—¶ï¼Œç”¨å…¶ä»–æ›¿ä»£å“ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚",
        encourage: "å¯¹æ›¿ä»£é€‰æ‹©è°šè¯­çš„åº”ç”¨å¾ˆæ°å½“ï¼çµæ´»åº”å˜çš„æ™ºæ…§æŒæ¡å¾—å¾ˆå¥½ã€‚"
    },
    {
        q: "Konvoi berbasikal yang dijalankan di jalan raya mungkin menjadi tragedi dan membahayakan penunggang basikal pada bila-bila masa. Peribahasa yang bersesuaian:",
        options: ["mencegah lebih baik daripada mengubati", "malang tidak berbau", "masa itu emas", "seperti katak di bawah tempurung"],
        answer: "malang tidak berbau",
        explain: "è¿™å¥è°šè¯­è¡¨ç¤ºæ„å¤–æˆ–ä¸å¹¸å¯èƒ½éšæ—¶å‘ç”Ÿï¼Œæ— æ³•é¢„æ–™ã€‚",
        encourage: "å¯¹å®‰å…¨è­¦ç¤ºè°šè¯­çš„ç†è§£å¾ˆåˆ°ä½ï¼å±é™©æ„è¯†çš„è¡¨è¾¾æŒæ¡å¾—å¾ˆå¥½ã€‚"
    },
    {
        q: "Mangsa-mangsa banjir itu amat bersyukur kepada sumbangan daripada semua pihak yang baik hati kerana mereka sedar bahawa:",
        options: ["malang tidak berbau", "kecil tapak tangan, nyiru ditadahkan", "tak lapuk dek hujan, tak lekang dek panas", "tiada rotan, akar pun berguna"],
        answer: "kecil tapak tangan, nyiru ditadahkan",
        explain: "è¿™å¥è°šè¯­è¡¨è¾¾å¯¹å¾—åˆ°å¸®åŠ©çš„æ„Ÿæ¿€ä¹‹æƒ…ï¼Œå³ä½¿æ˜¯å°å°çš„å¸®åŠ©ä¹Ÿè¦å¿ƒå­˜æ„Ÿæ¿€ã€‚",
        encourage: "å¯¹æ„Ÿæ©æƒ…å¢ƒçš„è°šè¯­é€‰æ‹©å¾ˆå‡†ç¡®ï¼æ„Ÿæ©ä¹‹å¿ƒçš„è¡¨è¾¾ç†è§£å¾—å¾ˆå¥½ã€‚"
    },
    {
        q: "Situasi yang menggambarkan peribahasa 'kecil tapak tangan, nyiru ditadahkan':",
        options: ["Seorang pelajar yang tidak bersyukur dengan keputusan peperiksaannya", "Seorang pekerja yang mengeluh tentang gaji yang diterima", "Seorang petani yang bersyukur dengan hasil tanaman yang sedikit", "Seorang saudagar yang tamak dengan keuntungan"],
        answer: "Seorang petani yang bersyukur dengan hasil tanaman yang sedikit",
        explain: "è¿™ä¸ªä¾‹å­å®Œç¾å±•ç°äº†å³ä½¿æ”¶è·ä¸å¤šä¹Ÿå¿ƒå­˜æ„Ÿæ¿€çš„æ€åº¦ï¼Œç¬¦åˆè°šè¯­å«ä¹‰ã€‚",
        encourage: "å¯¹æ„Ÿæ©è°šè¯­å®é™…åº”ç”¨çš„ç†è§£å¾ˆå®Œç¾ï¼çŸ¥è¶³å¸¸ä¹çš„æ™ºæ…§æŒæ¡å¾—å¾ˆå¥½ã€‚"
    },
    {
        q: "Peribahasa 'bagai aur dengan tebing' menggambarkan:",
        options: ["Persahabatan yang erat dan saling membantu", "Orang yang tidak mengenang budi", "Seseorang yang sombong", "Keadaan yang tidak menentu"],
        answer: "Persahabatan yang erat dan saling membantu",
        explain: "è¿™å¥è°šè¯­å½¢å®¹ä¸¤è€…ä¹‹é—´å¯†ä¸å¯åˆ†çš„å…³ç³»ï¼Œå°±åƒç«¹å­ä¸æ²³å²¸ç›¸ä¾ç›¸å­˜ã€‚",
        encourage: "å¯¹å‹è°Šè°šè¯­çš„ç†è§£å¾ˆç²¾å‡†ï¼ç›¸äº’ä¾å­˜å…³ç³»çš„æ¦‚å¿µæŒæ¡å¾—å¾ˆå¥½ã€‚"
    },
    {
        q: "Orang yang mempunyai ilmu pengetahuan yang terhad dan tidak tahu tentang hal yang berlaku di sekelilingnya boleh diumpamakan sebagai:",
        options: ["bagai pinang dibelah dua", "seperti katak di bawah tempurung", "bagai aur dengan tebing", "seperti anjing dengan kucing"],
        answer: "seperti katak di bawah tempurung",
        explain: "è¿™å¥è°šè¯­å½¢å®¹è§è¯†æµ…è–„ï¼Œä¸äº†è§£å¤–é¢ä¸–ç•Œçš„äººï¼Œå°±åƒäº•åº•ä¹‹è›™ã€‚",
        encourage: "å¯¹æ¯”å–»è°šè¯­çš„ç†è§£å¾ˆåˆ°ä½ï¼å½¢å®¹çŸ¥è¯†å±€é™æ€§çš„è¡¨è¾¾æŒæ¡å¾—å¾ˆå¥½ã€‚"
    },
    {
        q: "Situasi yang menggambarkan 'malang tidak berbau':",
        options: ["Seorang murid yang rajin belajar tetapi gagal dalam peperiksaan", "Seorang pekerja yang tiba lewat kerana kereta rosak", "Seorang atlet yang cedera secara tiba-tiba sebelum pertandingan penting", "Semua jawapan di atas"],
        answer: "Semua jawapan di atas",
        explain: "æ‰€æœ‰ä¾‹å­éƒ½è¯´æ˜äº†ä¸å¹¸æˆ–æ„å¤–å¯èƒ½çªç„¶é™ä¸´ï¼Œæ— æ³•é¢„æ–™ï¼Œç¬¦åˆè¿™å¥è°šè¯­çš„å«ä¹‰ã€‚",
        encourage: "å¯¹æ„å¤–è°šè¯­çš„å…¨é¢ç†è§£å¾ˆå‡ºè‰²ï¼ä½ èƒ½è¯†åˆ«å„ç§çªå‘çŠ¶å†µçš„ä¾‹å­ã€‚"
    }
];

function showTab(tabId) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Deactivate all tabs
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected tab content
    document.getElementById(tabId).classList.add('active');
    
    // Activate selected tab
    event.currentTarget.classList.add('active');
    
    // If history tab is selected, load history
    if (tabId === 'history') {
        loadHistory();
    }
}

function submitQuiz() {
    const name = document.getElementById('name').value;
    const form = document.getElementById('form').value;
    
    if (!name || !form) {
        alert("è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯ï¼");
        return;
    }
    
    let score = 0;
    let results = [];
    let unanswered = 0;
    
    questions.forEach((q, index) => {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        const isCorrect = selected && selected.value === q.answer;
        
        if (isCorrect) score++;
        if (!selected) unanswered++;
        
        results.push({
            question: q.q,
            selected: selected ? selected.value : "æœªä½œç­”",
            correct: q.answer,
            isCorrect: isCorrect,
            explain: q.explain,
            encourage: q.encourage
        });
    });
    
    // Save the attempt to history
    saveAttempt(name, form, score, results);
    
    // Display results
    displayResults(name, form, score, results, unanswered);
}

function displayResults(name, form, score, results, unanswered) {
    let output = `
        <h3>åå­—: ${name}</h3>
        <h3>å¹´çº§: ${form}</h3>
        <h3>å¾—åˆ†: <span class="${score >= 15 ? 'correct' : 'incorrect'}">${score} / 20</span></h3>
        ${unanswered > 0 ? `<p>æ³¨æ„ï¼šä½ æœ‰ ${unanswered} é¢˜æ²¡æœ‰ä½œç­”</p>` : ''}
        <p>${getFeedback(score)}</p>
        <div class="save-buttons">
            <button class="whatsapp-btn" onclick="sendToWhatsApp('${name}', '${form}', ${score}, ${unanswered}, 'teacher')">ğŸ“± å‘é€æ–‡å­—æˆç»©</button>
            <button class="whatsapp-btn" onclick="generateReportImage('${name}', '${form}', ${score}, ${unanswered})">ğŸ–¼ï¸ ä¸€é”®å‘é€å›¾ç‰‡æˆç»©å•</button>
        </div>
        <div id="reportCanvas" style="margin-top: 20px;"></div>
        <hr>
    `;
    
    results.forEach((r, index) => {
        output += `
            <div class="question">
                <p><strong>ç¬¬${index + 1}é¢˜ï¼š${r.isCorrect ? 'æ­£ç¡® âœ…' : 'é”™è¯¯ âŒ'}</strong></p>
                <p>é¢˜ç›®: ${r.question}</p>
                ${!r.isCorrect ? `<p>ä½ çš„ç­”æ¡ˆ: <span class="incorrect">${r.selected}</span></p>` : ''}
                <p>æ­£ç¡®ç­”æ¡ˆ: <span class="correct">${r.correct}</span></p>
                <p>è§£é‡Š: ${r.explain}</p>
                <p>é¼“åŠ±: ${r.encourage}</p>
            </div>
        `;
    });
    
    document.getElementById('result').innerHTML = output;
    document.getElementById('result').classList.remove('hidden');
    
    // Scroll to results
    document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
}

function getFeedback(score) {
    if (score === 20) {
        return "å¤ªå‰å®³å•¦ï¼å…¨å¯¹è€¶ï¼ä½ çš„é©¬æ¥è¯­è°šè¯­æŒæ¡å¾—éå¸¸æ£’ï¼ğŸ‰ ç»™è‡ªå·±ç‚¹ä¸ªèµå§ï¼";
    } else if (score >= 17) {
        return "æˆç»©å¾ˆä¸é”™å“¦ï¼åªæœ‰å‡ ä¸ªå°åœ°æ–¹éœ€è¦æ³¨æ„ï¼Œä½ å·²ç»æŒæ¡å¤§éƒ¨åˆ†è°šè¯­å•¦ï¼âœ¨";
    } else if (score >= 14) {
        return "æŒºå¥½çš„ï¼åŸºæœ¬è°šè¯­éƒ½æŒæ¡äº†ï¼Œé”™é¢˜çœ‹çœ‹è§£é‡Šï¼Œä¸‹æ¬¡ä¼šæ›´å¥½å“’ï¼ğŸ˜Š";
    } else if (score >= 10) {
        return "æœ‰è¿›æ­¥ç©ºé—´å“¦ï¼é”™é¢˜éƒ½æ˜¯å­¦ä¹ æœºä¼šï¼Œæ…¢æ…¢æ¥ï¼Œä½ çš„è°šè¯­ä¼šè¶Šæ¥è¶Šæ£’çš„ï¼ğŸ’ª";
    } else {
        return "ç¬¬ä¸€æ¬¡æ¥è§¦é©¬æ¥è¯­è°šè¯­å§ï¼Ÿåˆ«æ‹…å¿ƒï¼æ¯ä¸ªäººéƒ½æ˜¯è¿™æ ·è¿›æ­¥çš„ï¼Œå¤šç»ƒä¹ å°±ä¼šå¥½å¾ˆå¤šå•¦ï¼ğŸŒ±";
    }
}

function sendToWhatsApp(name, form, score, unanswered, recipient = 'teacher') {
    const date = new Date().toLocaleString();
    const percentage = Math.round((score / 20) * 100);
    const grade = getGrade(score);
    
    let message = '';
    let whatsappUrl = '';
    
    if (recipient === 'teacher') {
        message += `å°Šæ•¬çš„è€å¸ˆï¼Œæ‚¨å¥½ï¼\n\n`;
        message += `æˆ‘æ˜¯ ${name} (${form})ï¼Œåˆšå®Œæˆäº†BM Peribahasaæµ‹éªŒï¼Œç°å‘æ‚¨æ±‡æŠ¥æˆç»©ï¼š\n\n`;
        message += `ğŸ“Š æµ‹éªŒæˆç»©: ${score}/20 åˆ† (${percentage}%)\n`;
        message += `â­ ç­‰çº§: ${grade}\n`;
        message += `ğŸ“… æµ‹éªŒæ—¶é—´: ${date}\n`;
        if (unanswered > 0) {
            message += `âš ï¸ æœªå®Œæˆé¢˜ç›®: ${unanswered} é¢˜\n`;
        }
        message += `\nğŸ¯ æŒæ¡ç¨‹åº¦: ${getSkillLevel(score)}\n`;
        message += `\næˆ‘ä¼šç»§ç»­åŠªåŠ›å­¦ä¹ é©¬æ¥è¯­è°šè¯­ï¼Œè°¢è°¢è€å¸ˆçš„æŒ‡å¯¼ï¼`;
        
        // Encode the message for URL
        const encodedMessage = encodeURIComponent(message);
        
        // Create WhatsApp URL with specific teacher phone number
        whatsappUrl = `https://wa.me/60127317286?text=${encodedMessage}`;
        
    } else {
        // General message (fallback)
        message += `ğŸ“š BM Peribahasa Quiz æˆç»©æŠ¥å‘Š\n\n`;
        message += `ğŸ‘¤ å§“å: ${name}\n`;
        message += `ğŸ“ å¹´çº§: ${form}\n`;
        message += `ğŸ“… æµ‹éªŒæ—¥æœŸ: ${date}\n`;
        message += `ğŸ“Š å¾—åˆ†: ${score}/20 (${percentage}%)\n`;
        message += `â­ ç­‰çº§: ${grade}\n`;
        if (unanswered > 0) {
            message += `âš ï¸ æœªä½œç­”é¢˜ç›®: ${unanswered} é¢˜\n`;
        }
        message += `\nğŸ“ è¯„è¯­: ${getFeedback(score)}\n`;
        message += `\nğŸ¯ é©¬æ¥è¯­è°šè¯­æŒæ¡ç¨‹åº¦: ${getSkillLevel(score)}\n`;
        message += `\nğŸ’ª ç»§ç»­åŠ æ²¹ï¼Œå­¦å¥½é©¬æ¥è¯­è°šè¯­ï¼`;
        
        // Encode the message for URL
        const encodedMessage = encodeURIComponent(message);
        
        // Create general WhatsApp URL
        whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
    }
    
    // Open WhatsApp
    window.open(whatsappUrl, '_blank');
}

function generateReportImage(name, form, score, unanswered) {
    // Get current quiz results for error analysis
    let wrongAnswers = [];
    questions.forEach((q, index) => {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        const isCorrect = selected && selected.value === q.answer;
        if (!isCorrect) {
            wrongAnswers.push({
                number: index + 1,
                question: q.q.substring(0, 50) + "...",
                selected: selected ? selected.value : "æœªä½œç­”",
                correct: q.answer
            });
        }
    });

    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    // Set canvas size
    canvas.width = 800;
    canvas.height = 1000;
    
    // Background gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#f8f9fa');
    gradient.addColorStop(1, '#e9ecef');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Header background
    ctx.fillStyle = '#4CAF50';
    ctx.fillRect(0, 0, canvas.width, 120);
    
    // Title
    ctx.fillStyle = 'white';
    ctx.font = 'bold 32px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('BM Peribahasa Quiz', canvas.width/2, 50);
    ctx.fillText('é©¬æ¥è¯­è°šè¯­æµ‹éªŒæˆç»©å•', canvas.width/2, 90);
    
    // Student Info Section
    ctx.fillStyle = '#333';
    ctx.font = 'bold 24px Arial';
    ctx.textAlign = 'left';
    ctx.fillText('å­¦ç”Ÿä¿¡æ¯ Student Information', 50, 170);
    
    ctx.font = '20px Arial';
    ctx.fillText(`å§“å Name: ${name}`, 50, 210);
    ctx.fillText(`å¹´çº§ Form: ${form}`, 50, 240);
    ctx.fillText(`æµ‹éªŒæ—¥æœŸ Date: ${new Date().toLocaleDateString()}`, 50, 270);
    
    // Score Section
    const percentage = Math.round((score / 20) * 100);
    const grade = getGrade(score);
    
    ctx.fillStyle = '#2196F3';
    ctx.font = 'bold 24px Arial';
    ctx.fillText('æµ‹éªŒæˆç»© Test Results', 50, 320);
    
    // Score circle
    const centerX = canvas.width - 150;
    const centerY = 370;
    const radius = 80;
    
    // Draw score circle background
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.fillStyle = score >= 15 ? '#4CAF50' : score >= 10 ? '#FF9800' : '#F44336';
    ctx.fill();
    
    // Score text in circle
    ctx.fillStyle = 'white';
    ctx.font = 'bold 36px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(`${score}/20`, centerX, centerY - 10);
    ctx.font = 'bold 20px Arial';
    ctx.fillText(`${percentage}%`, centerX, centerY + 20);
    
    // Detailed scores
    ctx.fillStyle = '#333';
    ctx.font = '20px Arial';
    ctx.textAlign = 'left';
    ctx.fillText(`æ€»åˆ† Total Score: ${score}/20 (${percentage}%)`, 50, 360);
    ctx.fillText(`ç­‰çº§ Grade: ${grade}`, 50, 390);
    ctx.fillText(`æŠ€èƒ½æ°´å¹³ Skill Level: ${getSkillLevel(score)}`, 50, 420);
    
    if (unanswered > 0) {
        ctx.fillStyle = '#F44336';
        ctx.fillText(`æœªä½œç­”é¢˜ç›® Unanswered: ${unanswered} é¢˜`, 50, 450);
    }
    
    // Performance Analysis
    ctx.fillStyle = '#333';
    ctx.font = 'bold 24px Arial';
    ctx.fillText('è¡¨ç°åˆ†æ Performance Analysis', 50, 510);
    
    ctx.font = '18px Arial';
    const feedback = getFeedback(score);
    const words = feedback.split(' ');
    let line = '';
    let y = 540;
    
    for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        const testWidth = metrics.width;
        if (testWidth > 700 && n > 0) {
            ctx.fillText(line, 50, y);
            line = words[n] + ' ';
            y += 25;
        } else {
            line = testLine;
        }
    }
    ctx.fillText(line, 50, y);
    
    // Wrong Answers Section (if any)
    if (wrongAnswers.length > 0) {
        y += 50;
        ctx.fillStyle = '#F44336';
        ctx.font = 'bold 20px Arial';
        ctx.fillText(`é”™é¢˜åˆ†æ Wrong Answers (${wrongAnswers.length} é¢˜)`, 50, y);
        
        ctx.fillStyle = '#333';
        ctx.font = '16px Arial';
        
        wrongAnswers.slice(0, 5).forEach((error, index) => {
            y += 30;
            ctx.fillText(`${index + 1}. ç¬¬${error.number}é¢˜: ${error.selected} â†’ ${error.correct}`, 50, y);
        });
        
        if (wrongAnswers.length > 5) {
            y += 25;
            ctx.fillText(`... è¿˜æœ‰ ${wrongAnswers.length - 5} é“é”™é¢˜`, 50, y);
        }
    }
    
    // Footer
    ctx.fillStyle = '#666';
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('ç»§ç»­åŠ æ²¹ï¼Œå­¦å¥½é©¬æ¥è¯­è°šè¯­ï¼Keep up the good work!', canvas.width/2, canvas.height - 30);
    
    // Display canvas and download options
    const reportDiv = document.getElementById('reportCanvas');
    reportDiv.innerHTML = `
        <div class="canvas-container">
            <h3>ğŸ“‹ æˆç»©å•å·²ç”Ÿæˆ</h3>
            <canvas id="generatedCanvas" width="800" height="1000" style="max-width: 100%; height: auto; border: 1px solid #ddd;"></canvas>
            <div style="margin-top: 15px;">
                <button class="download-btn" onclick="downloadReportImage()">ğŸ’¾ ä¸‹è½½å›¾ç‰‡</button>
                <button class="whatsapp-btn" onclick="shareReportImage()">ğŸ“± ä¸€é”®å‘é€ç»™è€å¸ˆ</button>
            </div>
            <p style="color: #666; font-size: 14px; margin-top: 10px;">
                ğŸ’¡ æç¤ºï¼šç‚¹å‡»"ä¸€é”®å‘é€ç»™è€å¸ˆ"åœ¨æ”¯æŒçš„è®¾å¤‡ä¸Šå¯ç›´æ¥åˆ†äº«å›¾ç‰‡åˆ°WhatsAppï¼
            </p>
        </div>
    `;
    
    // Copy canvas content to displayed canvas
    const displayCanvas = document.getElementById('generatedCanvas');
    const displayCtx = displayCanvas.getContext('2d');
    displayCtx.drawImage(canvas, 0, 0);
    
    // Store canvas globally for download
    window.reportCanvas = canvas;
    
    // Scroll to canvas
    reportDiv.scrollIntoView({ behavior: 'smooth' });
}

function downloadReportImage() {
    if (window.reportCanvas) {
        const link = document.createElement('a');
        link.download = `BM_Peribahasa_æˆç»©å•_${new Date().toISOString().split('T')[0]}.png`;
        link.href = window.reportCanvas.toDataURL();
        link.click();
    }
}

function shareReportImage() {
    if (window.reportCanvas) {
        // Check if the device supports native sharing
        if (navigator.share) {
            // Convert canvas to blob for native sharing
            window.reportCanvas.toBlob(function(blob) {
                const file = new File([blob], `BM_Peribahasa_æˆç»©å•_${new Date().toISOString().split('T')[0]}.png`, { type: 'image/png' });
                
                navigator.share({
                    title: 'BM Peribahasa Quiz æˆç»©å•',
                    text: 'è€å¸ˆæ‚¨å¥½ï¼è¿™æ˜¯æˆ‘çš„BM Peribahasaæµ‹éªŒæˆç»©å•',
                    files: [file]
                }).then(() => {
                    console.log('æˆåŠŸåˆ†äº«å›¾ç‰‡');
                }).catch((error) => {
                    console.log('åˆ†äº«å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ:', error);
                    fallbackShare();
                });
            });
        } else {
            // Fallback for devices that don't support native sharing
            fallbackShare();
        }
    } else {
        alert('è¯·å…ˆç”Ÿæˆæˆç»©å•å›¾ç‰‡ï¼');
    }
}

function fallbackShare() {
    // Download the image first
    const link = document.createElement('a');
    link.download = `BM_Peribahasa_æˆç»©å•_${new Date().toISOString().split('T')[0]}.png`;
    link.href = window.reportCanvas.toDataURL();
    link.click();
    
    // Open teacher's WhatsApp with a pre-filled message
    const message = encodeURIComponent('è€å¸ˆæ‚¨å¥½ï¼æˆ‘åˆšå®Œæˆäº†BM Peribahasaæµ‹éªŒï¼Œç°åœ¨å‘é€æˆç»©å•å›¾ç‰‡ç»™æ‚¨æŸ¥çœ‹ ğŸ“‹');
    
    // Small delay to ensure download completes
    setTimeout(() => {
        window.open(`https://wa.me/60127317286?text=${message}`, '_blank');
        
        // Show simplified instructions
        setTimeout(() => {
            alert('ğŸ“± WhatsAppå·²æ‰“å¼€ï¼\n\nç®€å•3æ­¥å®Œæˆå‘é€ï¼š\n1ï¸âƒ£ ç‚¹å‡» ğŸ“ é™„ä»¶å›¾æ ‡\n2ï¸âƒ£ é€‰æ‹© "ç›¸å†Œ" æˆ– "æ–‡æ¡£"\n3ï¸âƒ£ é€‰æ‹©åˆšä¸‹è½½çš„æˆç»©å•å›¾ç‰‡å³å¯å‘é€ï¼');
        }, 800);
    }, 500);
}

// New function for one-click sharing from history
function quickShareHistoryImage(attemptIndex) {
    const attempts = JSON.parse(localStorage.getItem('peribahasaQuizAttempts') || '[]');
    const attempt = attempts[attemptIndex];
    
    if (!attempt) {
        alert("æ‰¾ä¸åˆ°è¯¥æµ‹éªŒè®°å½•ï¼");
        return;
    }
    
    // Generate image and immediately try to share
    generateHistoryReportImageAndShare(attempt);
}

function generateHistoryReportImageAndShare(attempt) {
    const unanswered = attempt.results.filter(r => r.selected === "æœªä½œç­”").length;
    const wrongAnswers = attempt.results.filter(r => !r.isCorrect).map((r, index) => ({
        number: attempt.results.indexOf(r) + 1,
        question: r.question.substring(0, 50) + "...",
        selected: r.selected,
        correct: r.correct
    }));

    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 800;
    canvas.height = 1000;
    
    // Background gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#f8f9fa');
    gradient.addColorStop(1, '#e9ecef');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Header background
    ctx.fillStyle = '#4CAF50';
    ctx.fillRect(0, 0, canvas.width, 120);
    
    // Title
    ctx.fillStyle = 'white';
    ctx.font = 'bold 32px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('BM Peribahasa Quiz', canvas.width/2, 50);
    ctx.fillText('é©¬æ¥è¯­è°šè¯­æµ‹éªŒæˆç»©å•', canvas.width/2, 90);
    
    // Student Info Section
    ctx.fillStyle = '#333';
    ctx.font = 'bold 24px Arial';
    ctx.textAlign = 'left';
    ctx.fillText('å­¦ç”Ÿä¿¡æ¯ Student Information', 50, 170);
    
    ctx.font = '20px Arial';
    ctx.fillText(`å§“å Name: ${attempt.name}`, 50, 210);
    ctx.fillText(`å¹´çº§ Form: ${attempt.form}`, 50, 240);
    ctx.fillText(`æµ‹éªŒæ—¥æœŸ Date: ${attempt.date}`, 50, 270);
    
    // Score Section
    const percentage = Math.round((attempt.score / 20) * 100);
    const grade = getGrade(attempt.score);
    
    ctx.fillStyle = '#2196F3';
    ctx.font = 'bold 24px Arial';
    ctx.fillText('æµ‹éªŒæˆç»© Test Results', 50, 320);
    
    // Score circle
    const centerX = canvas.width - 150;
    const centerY = 370;
    const radius = 80;
    
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.fillStyle = attempt.score >= 15 ? '#4CAF50' : attempt.score >= 10 ? '#FF9800' : '#F44336';
    ctx.fill();
    
    // Score text in circle
    ctx.fillStyle = 'white';
    ctx.font = 'bold 36px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(`${attempt.score}/20`, centerX, centerY - 10);
    ctx.font = 'bold 20px Arial';
    ctx.fillText(`${percentage}%`, centerX, centerY + 20);
    
    // Detailed scores
    ctx.fillStyle = '#333';
    ctx.font = '20px Arial';
    ctx.textAlign = 'left';
    ctx.fillText(`æ€»åˆ† Total: ${attempt.score}/20 (${percentage}%)`, 50, 360);
    ctx.fillText(`ç­‰çº§ Grade: ${grade}`, 50, 390);
    ctx.fillText(`æŠ€èƒ½æ°´å¹³ Level: ${getSkillLevel(attempt.score)}`, 50, 420);
    
    if (unanswered > 0) {
        ctx.fillStyle = '#F44336';
        ctx.fillText(`æœªä½œç­” Unanswered: ${unanswered} é¢˜`, 50, 450);
    }
    
    // Performance Analysis
    ctx.fillStyle = '#333';
    ctx.font = 'bold 24px Arial';
    ctx.fillText('è¡¨ç°åˆ†æ Performance Analysis', 50, 500);
    
    ctx.font = '18px Arial';
    const feedback = getFeedback(attempt.score);
    ctx.fillText(feedback.substring(0, 80), 50, 530);
    if (feedback.length > 80) {
        ctx.fillText(feedback.substring(80), 50, 555);
    }
    
    // Wrong Answers Section
    if (wrongAnswers.length > 0) {
        ctx.fillStyle = '#F44336';
        ctx.font = 'bold 20px Arial';
        ctx.fillText(`é”™é¢˜åˆ†æ Wrong Answers (${wrongAnswers.length})`, 50, 600);
        
        ctx.fillStyle = '#333';
        ctx.font = '16px Arial';
        wrongAnswers.slice(0, 4).forEach((error, index) => {
            const y = 630 + (index * 25);
            ctx.fillText(`${index + 1}. Q${error.number}: ${error.selected} â†’ ${error.correct}`, 50, y);
        });
    }
    
    // Footer
    ctx.fillStyle = '#666';
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('ç»§ç»­åŠ æ²¹ï¼Œå­¦å¥½é©¬æ¥è¯­è°šè¯­ï¼', canvas.width/2, canvas.height - 30);
    
    // Try to share immediately
    if (navigator.share) {
        canvas.toBlob(function(blob) {
            const file = new File([blob], `æˆç»©å•_${attempt.name}_${new Date().toISOString().split('T')[0]}.png`, { type: 'image/png' });
            
            navigator.share({
                title: 'BM Peribahasa Quiz æˆç»©å•',
                text: `è€å¸ˆæ‚¨å¥½ï¼è¿™æ˜¯${attempt.name}çš„BM Peribahasaæµ‹éªŒæˆç»©å•`,
                files: [file]
            }).catch(() => {
                fallbackShareHistory(canvas, attempt);
            });
        });
    } else {
        fallbackShareHistory(canvas, attempt);
    }
}

function fallbackShareHistory(canvas, attempt) {
    // Download image
    const link = document.createElement('a');
    link.download = `æˆç»©å•_${attempt.name}_${attempt.date.replace(/[/:]/g, '-')}.png`;
    link.href = canvas.toDataURL();
    link.click();
    
    // Open WhatsApp
    const message = encodeURIComponent(`è€å¸ˆæ‚¨å¥½ï¼æˆ‘æ˜¯${attempt.name}ï¼Œå‘é€æˆç»©å•å›¾ç‰‡ç»™æ‚¨æŸ¥çœ‹ ğŸ“‹`);
    setTimeout(() => {
        window.open(`https://wa.me/60127317286?text=${message}`, '_blank');
        alert('ğŸ“± å›¾ç‰‡å·²ä¸‹è½½ï¼WhatsAppå·²æ‰“å¼€ï¼Œè¯·é™„åŠ å›¾ç‰‡å‘é€ç»™è€å¸ˆ');
    }, 500);
}

function getGrade(score) {
    if (score >= 18) return "A+ ä¼˜ç§€";
    if (score >= 16) return "A è‰¯å¥½";
    if (score >= 14) return "B+ ä¸é”™";
    if (score >= 12) return "B åŠæ ¼";
    if (score >= 10) return "C+ éœ€è¦åŠªåŠ›";
    if (score >= 8) return "C éœ€è¦åŠ å¼º";
    return "D éœ€è¦é‡æ–°å­¦ä¹ ";
}

function getSkillLevel(score) {
    if (score >= 18) return "ä¸“å®¶çº§ ğŸŒŸ";
    if (score >= 15) return "ç†Ÿç»ƒçº§ â­";
    if (score >= 12) return "ä¸­çº§ ğŸ“š";
    if (score >= 8) return "åˆçº§ ğŸ“–";
    return "å…¥é—¨çº§ ğŸ”°";
}

function saveAttempt(name, form, score, results) {
    const attempts = JSON.parse(localStorage.getItem('peribahasaQuizAttempts') || '[]');
    const attempt = {
        date: new Date().toLocaleString(),
        name,
        form,
        score,
        results
    };
    
    attempts.unshift(attempt); // Add new attempt at beginning
    localStorage.setItem('peribahasaQuizAttempts', JSON.stringify(attempts));
}

function loadHistory() {
    const attempts = JSON.parse(localStorage.getItem('peribahasaQuizAttempts') || '[]');
    const historyList = document.getElementById('historyList');
    
    if (attempts.length === 0) {
        historyList.innerHTML = "<p>ä½ è¿˜æ²¡æœ‰ä»»ä½•æµ‹éªŒè®°å½•ï¼Œå¿«å»åšæµ‹éªŒå§ï¼</p>";
        return;
    }
    
    let html = "";
    attempts.forEach((attempt, index) => {
        html += `
            <div class="question" style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px;">
                <h3>æµ‹éªŒ #${index + 1} - ${attempt.date}</h3>
                <p>å§“å: ${attempt.name} | å¹´çº§: ${attempt.form}</p>
                <p>å¾—åˆ†: <strong>${attempt.score} / 20</strong></p>
                <button onclick="viewAttemptDetails(${index})">æŸ¥çœ‹è¯¦æƒ…</button>
                <div style="margin-top: 10px;">
                    <button class="whatsapp-btn" onclick="sendHistoryToWhatsApp(${index}, 'teacher')" style="font-size: 12px; padding: 8px 12px;">ğŸ“± å‘é€æ–‡å­—æˆç»©</button>
                    <button class="download-btn" onclick="quickShareHistoryImage(${index})" style="font-size: 12px; padding: 8px 12px;">ğŸ–¼ï¸ ä¸€é”®å‘é€å›¾ç‰‡</button>
                </div>
                <div id="attemptDetails${index}" style="display: none; margin-top: 10px;">
                    ${attempt.results.map((r, qIndex) => `
                        <div style="margin-bottom: 15px; padding: 10px; background: ${r.isCorrect ? '#e6ffe6' : '#ffe6e6'}; border-radius: 5px;">
                            <p><strong>ç¬¬${qIndex + 1}é¢˜ï¼š${r.isCorrect ? 'æ­£ç¡® âœ…' : 'é”™è¯¯ âŒ'}</strong></p>
                            <p>é¢˜ç›®: ${r.question}</p>
                            ${!r.isCorrect ? `<p>ä½ çš„ç­”æ¡ˆ: ${r.selected}</p>` : ''}
                            <p>æ­£ç¡®ç­”æ¡ˆ: ${r.correct}</p>
                            <p>è§£é‡Š: ${r.explain}</p>
                            <p>é¼“åŠ±: ${r.encourage}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    });
    
    historyList.innerHTML = html;
}

function sendHistoryToWhatsApp(attemptIndex, recipient = 'teacher') {
    const attempts = JSON.parse(localStorage.getItem('peribahasaQuizAttempts') || '[]');
    const attempt = attempts[attemptIndex];
    
    if (!attempt) {
        alert("æ‰¾ä¸åˆ°è¯¥æµ‹éªŒè®°å½•ï¼");
        return;
    }
    
    const percentage = Math.round((attempt.score / 20) * 100);
    const grade = getGrade(attempt.score);
    const unanswered = attempt.results.filter(r => r.selected === "æœªä½œç­”").length;
    
    let message = '';
    let whatsappUrl = '';
    
    if (recipient === 'teacher') {
        message += `å°Šæ•¬çš„è€å¸ˆï¼Œæ‚¨å¥½ï¼\n\n`;
        message += `æˆ‘æ˜¯ ${attempt.name} (${attempt.form})ï¼Œå‘æ‚¨æ±‡æŠ¥BM Peribahasaæµ‹éªŒæˆç»©ï¼š\n\n`;
        message += `ğŸ“Š æµ‹éªŒæˆç»©: ${attempt.score}/20 åˆ† (${percentage}%)\n`;
        message += `â­ ç­‰çº§: ${grade}\n`;
        message += `ğŸ“… æµ‹éªŒæ—¶é—´: ${attempt.date}\n`;
        if (unanswered > 0) {
            message += `âš ï¸ æœªå®Œæˆé¢˜ç›®: ${unanswered} é¢˜\n`;
        }
        message += `\nğŸ¯ æŒæ¡ç¨‹åº¦: ${getSkillLevel(attempt.score)}\n`;
        
        // Add wrong answers for teacher
        const wrongAnswers = attempt.results.filter(r => !r.isCorrect);
        if (wrongAnswers.length > 0) {
            message += `\nâŒ éœ€è¦åŠ å¼ºçš„é¢˜ç›®:\n`;
            wrongAnswers.slice(0, 3).forEach((r, index) => {
                const qNum = attempt.results.indexOf(r) + 1;
                message += `${index + 1}. ç¬¬${qNum}é¢˜: é€‰æ‹©äº†"${r.selected}"ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯"${r.correct}"\n`;
            });
            if (wrongAnswers.length > 3) {
                message += `... è¿˜æœ‰ ${wrongAnswers.length - 3} é“éœ€è¦å¤ä¹ \n`;
            }
        }
        
        message += `\næˆ‘ä¼šé’ˆå¯¹é”™é¢˜è¿›è¡Œå¤ä¹ ï¼Œè°¢è°¢è€å¸ˆçš„æŒ‡å¯¼ï¼`;
        
        // Encode the message for URL
        const encodedMessage = encodeURIComponent(message);
        
        // Create WhatsApp URL with specific teacher phone number
        whatsappUrl = `https://wa.me/60127317286?text=${encodedMessage}`;
        
    } else {
        // General message (keeping the original format)
        message += `ğŸ“š BM Peribahasa Quiz æˆç»©æŠ¥å‘Š\n\n`;
        message += `ğŸ‘¤ å§“å: ${attempt.name}\n`;
        message += `ğŸ“ å¹´çº§: ${attempt.form}\n`;
        message += `ğŸ“… æµ‹éªŒæ—¥æœŸ: ${attempt.date}\n`;
        message += `ğŸ“Š å¾—åˆ†: ${attempt.score}/20 (${percentage}%)\n`;
        message += `â­ ç­‰çº§: ${grade}\n`;
        
        if (unanswered > 0) {
            message += `âš ï¸ æœªä½œç­”é¢˜ç›®: ${unanswered} é¢˜\n`;
        }
        
        message += `\nğŸ“ è¯„è¯­: ${getFeedback(attempt.score)}\n`;
        message += `\nğŸ¯ é©¬æ¥è¯­è°šè¯­æŒæ¡ç¨‹åº¦: ${getSkillLevel(attempt.score)}\n`;
        
        // Add wrong answers details
        const wrongAnswers = attempt.results.filter(r => !r.isCorrect);
        if (wrongAnswers.length > 0) {
            message += `\nâŒ é”™é¢˜åˆ†æ:\n`;
            wrongAnswers.slice(0, 3).forEach((r, index) => {
                const qNum = attempt.results.indexOf(r) + 1;
                message += `${index + 1}. ç¬¬${qNum}é¢˜: ${r.selected} â†’ ${r.correct}\n`;
            });
            if (wrongAnswers.length > 3) {
                message += `... è¿˜æœ‰ ${wrongAnswers.length - 3} é“é”™é¢˜\n`;
            }
        }
        
        message += `\nğŸ’ª ç»§ç»­åŠ æ²¹ï¼Œå­¦å¥½é©¬æ¥è¯­è°šè¯­ï¼`;
        
        // Encode the message for URL
        const encodedMessage = encodeURIComponent(message);
        
        // Create general WhatsApp URL
        whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
    }
    
    // Open WhatsApp
    window.open(whatsappUrl, '_blank');
}

function generateHistoryReportImage(attemptIndex) {
    const attempts = JSON.parse(localStorage.getItem('peribahasaQuizAttempts') || '[]');
    const attempt = attempts[attemptIndex];
    
    if (!attempt) {
        alert("æ‰¾ä¸åˆ°è¯¥æµ‹éªŒè®°å½•ï¼");
        return;
    }
    
    const unanswered = attempt.results.filter(r => r.selected === "æœªä½œç­”").length;
    const wrongAnswers = attempt.results.filter(r => !r.isCorrect).map((r, index) => ({
        number: attempt.results.indexOf(r) + 1,
        question: r.question.substring(0, 50) + "...",
        selected: r.selected,
        correct: r.correct
    }));

    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    // Set canvas size
    canvas.width = 800;
    canvas.height = 1000;
    
    // Background gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#f8f9fa');
    gradient.addColorStop(1, '#e9ecef');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Header background
    ctx.fillStyle = '#4CAF50';
    ctx.fillRect(0, 0, canvas.width, 120);
    
    // Title
    ctx.fillStyle = 'white';
    ctx.font = 'bold 32px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('BM Peribahasa Quiz', canvas.width/2, 50);
    ctx.fillText('é©¬æ¥è¯­è°šè¯­æµ‹éªŒæˆç»©å•', canvas.width/2, 90);
    
    // Student Info Section
    ctx.fillStyle = '#333';
    ctx.font = 'bold 24px Arial';
    ctx.textAlign = 'left';
    ctx.fillText('å­¦ç”Ÿä¿¡æ¯ Student Information', 50, 170);
    
    ctx.font = '20px Arial';
    ctx.fillText(`å§“å Name: ${attempt.name}`, 50, 210);
    ctx.fillText(`å¹´çº§ Form: ${attempt.form}`, 50, 240);
    ctx.fillText(`æµ‹éªŒæ—¥æœŸ Date: ${attempt.date}`, 50, 270);
    
    // Score Section
    const percentage = Math.round((attempt.score / 20) * 100);
    const grade = getGrade(attempt.score);
    
    ctx.fillStyle = '#2196F3';
    ctx.font = 'bold 24px Arial';
    ctx.fillText('æµ‹éªŒæˆç»© Test Results', 50, 320);
    
    // Score circle
    const centerX = canvas.width - 150;
    const centerY = 370;
    const radius = 80;
    
    // Draw score circle background
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.fillStyle = attempt.score >= 15 ? '#4CAF50' : attempt.score >= 10 ? '#FF9800' : '#F44336';
    ctx.fill();
    
    // Score text in circle
    ctx.fillStyle = 'white';
    ctx.font = 'bold 36px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(`${attempt.score}/20`, centerX, centerY - 10);
    ctx.font = 'bold 20px Arial';
    ctx.fillText(`${percentage}%`, centerX, centerY + 20);
    
    // Detailed scores
    ctx.fillStyle = '#333';
    ctx.font = '20px Arial';
    ctx.textAlign = 'left';
    ctx.fillText(`æ€»åˆ† Total Score: ${attempt.score}/20 (${percentage}%)`, 50, 360);
    ctx.fillText(`ç­‰çº§ Grade: ${grade}`, 50, 390);
    ctx.fillText(`æŠ€èƒ½æ°´å¹³ Skill Level: ${getSkillLevel(attempt.score)}`, 50, 420);
    
    if (unanswered > 0) {
        ctx.fillStyle = '#F44336';
        ctx.fillText(`æœªä½œç­”é¢˜ç›® Unanswered: ${unanswered} é¢˜`, 50, 450);
    }
    
    // Performance Analysis
    ctx.fillStyle = '#333';
    ctx.font = 'bold 24px Arial';
    ctx.fillText('è¡¨ç°åˆ†æ Performance Analysis', 50, 510);
    
    ctx.font = '18px Arial';
    const feedback = getFeedback(attempt.score);
    const words = feedback.split(' ');
    let line = '';
    let y = 540;
    
    for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        const testWidth = metrics.width;
        if (testWidth > 700 && n > 0) {
            ctx.fillText(line, 50, y);
            line = words[n] + ' ';
            y += 25;
        } else {
            line = testLine;
        }
    }
    ctx.fillText(line, 50, y);
    
    // Wrong Answers Section (if any)
    if (wrongAnswers.length > 0) {
        y += 50;
        ctx.fillStyle = '#F44336';
        ctx.font = 'bold 20px Arial';
        ctx.fillText(`é”™é¢˜åˆ†æ Wrong Answers (${wrongAnswers.length} é¢˜)`, 50, y);
        
        ctx.fillStyle = '#333';
        ctx.font = '16px Arial';
        
        wrongAnswers.slice(0, 5).forEach((error, index) => {
            y += 30;
            ctx.fillText(`${index + 1}. ç¬¬${error.number}é¢˜: ${error.selected} â†’ ${error.correct}`, 50, y);
        });
        
        if (wrongAnswers.length > 5) {
            y += 25;
            ctx.fillText(`... è¿˜æœ‰ ${wrongAnswers.length - 5} é“é”™é¢˜`, 50, y);
        }
    }
    
    // Footer
    ctx.fillStyle = '#666';
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('ç»§ç»­åŠ æ²¹ï¼Œå­¦å¥½é©¬æ¥è¯­è°šè¯­ï¼Keep up the good work!', canvas.width/2, canvas.height - 30);
    
    // Create download link
    const link = document.createElement('a');
    link.download = `BM_Peribahasa_æˆç»©å•_${attempt.name}_${attempt.date.replace(/[/:]/g, '-')}.png`;
    link.href = canvas.toDataURL();
    link.click();
    
    // Open teacher's WhatsApp with message
    const message = encodeURIComponent(`è€å¸ˆæ‚¨å¥½ï¼æˆ‘æ˜¯${attempt.name}ï¼Œè¿™æ˜¯æˆ‘${attempt.date}çš„BM Peribahasaæµ‹éªŒæˆç»©å•ï¼Œè¯·æŸ¥çœ‹ ğŸ“‹`);
    
    // Small delay to ensure download starts first
    setTimeout(() => {
        window.open(`https://wa.me/60127317286?text=${message}`, '_blank');
    }, 500);
    
    // Also show success message with instructions
    setTimeout(() => {
        alert('ğŸ“± æˆç»©å•å›¾ç‰‡å·²ä¸‹è½½ï¼WhatsAppå¯¹è¯å·²æ‰“å¼€\n\nè¯·åœ¨å¯¹è¯ä¸­é™„åŠ åˆšä¸‹è½½çš„å›¾ç‰‡å‘é€ç»™è€å¸ˆå³å¯ï¼');
    }, 1000);
}

function viewAttemptDetails(index) {
    const detailsDiv = document.getElementById(`attemptDetails${index}`);
    if (detailsDiv.style.display === 'none') {
        detailsDiv.style.display = 'block';
    } else {
        detailsDiv.style.display = 'none';
    }
}

function saveProgress() {
    const name = document.getElementById('name').value;
    const form = document.getElementById('form').value;
    
    if (!name || !form) {
        alert("è¯·å…ˆå¡«å†™ä¸ªäººä¿¡æ¯ï¼");
        return;
    }
    
    const progress = {
        name,
        form,
        answers: []
    };
    
    questions.forEach((q, index) => {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        progress.answers.push(selected ? selected.value : null);
    });
    
    localStorage.setItem('peribahasaQuizProgress', JSON.stringify(progress));
    alert("è¿›åº¦å·²ä¿å­˜ï¼ä½ å¯ä»¥ç¨åå›æ¥ç»§ç»­å®Œæˆæµ‹éªŒã€‚");
}

function loadProgress() {
    const progress = JSON.parse(localStorage.getItem('peribahasaQuizProgress'));
    
    if (!progress) {
        alert("æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„è¿›åº¦ï¼");
        return;
    }
    
    document.getElementById('name').value = progress.name;
    document.getElementById('form').value = progress.form;
    
    progress.answers.forEach((answer, index) => {
        if (answer) {
            const radio = document.querySelector(`input[name="q${index}"][value="${answer}"]`);
            if (radio) radio.checked = true;
        }
    });
    
    alert("è¿›åº¦å·²åŠ è½½ï¼ä½ å¯ä»¥ç»§ç»­å®Œæˆæµ‹éªŒã€‚");
}

window.onload = function() {
    const qDiv = document.getElementById('questions');
    questions.forEach((q, index) => {
        const div = document.createElement('div');
        div.className = "question";
        div.innerHTML = `<p><strong>ç¬¬${index + 1}é¢˜.</strong> ${q.q}</p>` +
                        q.options.map(opt => `
                            <label><input type="radio" name="q${index}" value="${opt}"> ${opt}</label><br>
                        `).join('');
        qDiv.appendChild(div);
    });
    
    // Check if there's saved progress
    if (localStorage.getItem('peribahasaQuizProgress')) {
        if (confirm("æ£€æµ‹åˆ°æœ‰ä¿å­˜çš„è¿›åº¦ï¼Œæ˜¯å¦åŠ è½½ï¼Ÿ")) {
            loadProgress();
        }
    }
}
</script>

</body>
</html>